# ArchPlanks — текущее состояние и план

## 1. Что подтянуто из репозитория (коммит 36c6d38)

**Изменения с домашней машины:**
- Добавлена палитра **SendXlsPalette** (Send to Excel) — класс, регистрация, `SaveCsvWithDialog`, вызов `ACAPI.SaveSendXls()` из JS
- Добавлена кнопка **«Отправить в Excel»** на тулбар (4 кнопки: Close, Table, Excel, Support)
- Добавлен `DATA 300` для `Send_Xls_Palette.html`
- Добавлены планы: `ACTION_PLAN.md`, `CLEANUP_SRC_AND_UI_VYBORKA.plan.md`
- Обновлены: `BUILD_INSTRUCTIONS.md`, `LICENSE_SYSTEM.md`, `license.example.lic`
- Удалены мусорные файлы: `-files Select-String...`, `bject -First 5`
- **GUID палитры BrowserRepl** изменён на `{22a3b4c5-6d7e-8f9a-0b1c-2d3e4f5a6b7c}`
- **GUID SendXlsPalette** задан как `{55d6e7f8-9a0b-1c2d-3e4f-5a6b7c8d9e0f}`
- Лицензия: `SKIP_LICENSE_FOR_TESTS 1` для тестов

---

## 2. Текущее состояние проекта

| Компонент | Статус |
|-----------|--------|
| Меню ArchPlanks | ✅ Таблица выделенного, Поддержка, Toolbar |
| Тулбар | ✅ Close, Table, Excel, Support |
| Selection Details (Таблица выделенного) | ✅ Работает |
| Help (Поддержка) | ✅ Открывает URL лицензии |
| Send Xls (Отправка в Excel) | ✅ Панель + `SaveSendXls` в C++ |
| Лицензия / демо | ✅ Работает (SKIP=1 для тестов) |
| GDL CutPlanBoard | ✅ Скрипты в `GDLScripts/` |
| План распила (Cutting Plan) | ❌ Не реализован |
| Имя .apx | `LandscapeHelper_AC29.apx` (Release) или `ArchPlanks.apx` (Debug) |

**Хелперы в Src (все на месте после pull):** BuildHelper, ColumnOrientHelper, GDLHelper, GroundHelper, LandscapeHelper, LayerHelper, MarkupHelper, MeshIntersectionHelper, PropertyUtils, RandomizerHelper, RoadHelper, RotateHelper, ShellHelper, UserItemDialog.

---

## 3. Локальный stash (офисные правки)

В stash сохранены правки: удаление хелперов, переименование в ArchPlanks_AC29, упрощение до 3 кнопок (без Excel). **Рекомендация:** не восстанавливать stash — дома уже сделана другая ветка (SendXls + полный набор хелперов).

---

## 4. Что дальше — план по этапам

### Этап 0 — Привести в порядок (если нужно)

| # | Задача | Комментарий |
|---|--------|-------------|
| 0.1 | Унифицировать имя плагина | Сейчас в Release — `LandscapeHelper_AC29.apx`. Варианты: оставить или перейти на `ArchPlanks_AC29.apx` (CMakeLists, LicenseManager). |
| 0.2 | Сборка и проверка | `cmake --build build --config Release` — убедиться, что всё собирается. |
| 0.3 | Проверить GUID палитр | Archicad должен видеть палитры. GUID уже обновлены (BrowserRepl, SendXlsPalette). Проверить HelpPalette и SelectionDetailsPalette — у них свои GUID. |

### Этап 1 — Доработать «Отправка в Excel» (если нужно)

По `ACTION_PLAN` — UI и C++ уже есть. Остаётся:
- Локализация строк
- Проверка экспорта CSV, кодировка UTF-8
- Уведомление после успешного сохранения

### Этап 2 — «План распила» (Cutting Plan)

По `CuttingPlan_plan.md`:
1. **CuttingStockSolver** — модуль без ACAPI (структуры, алгоритм Best-Fit + локальный поиск)
2. **CutPlanBoardHelper** — работа с ArchiFramePlank, создание CutPlanBoard
3. **GDL CutPlanBoard** — уже есть в `GDLScripts/`, подключить в библиотеку
4. **Палитра «План распила»** — HTML + регистрация + кнопка в меню

### Этап 3 — Очистка (по желанию)

По `CLEANUP_SRC_AND_UI_VYBORKA.plan.md`:
- Удалить лишние хелперы (если не нужны для плана распила)
- Переименовать «Таблица выделенного» → «Выборка»
- Заменить HelpPalette на ShellExecute (открытие URL в браузере)
- Перенести кнопку Excel с тулбара в палитру Выборка

---

## 5. Рекомендуемый порядок

1. **Сейчас:** проверить сборку и работу плагина в Archicad (палитры, Excel).
2. **Далее:** выбрать приоритет — сначала доработать Excel или сразу приступить к «Плану распила».
3. **Позже:** решить, делать ли очистку (удаление хелперов, переименование) — часть хелперов (GDLHelper, SelectionHelper) может понадобиться для плана распила.

---

## 6. Файлы планов в проекте

- `Plans/ACTION_PLAN.md` — общий план (этапы 0–3)
- `Plans/CLEANUP_SRC_AND_UI_VYBORKA.plan.md` — очистка Src и UI
- `Plans/CuttingPlan_plan.md` — алгоритм и структура плана распила
- `Plans/ТЕКУЩЕЕ_СОСТОЯНИЕ_И_ПЛАН.md` — этот файл (сводка)
